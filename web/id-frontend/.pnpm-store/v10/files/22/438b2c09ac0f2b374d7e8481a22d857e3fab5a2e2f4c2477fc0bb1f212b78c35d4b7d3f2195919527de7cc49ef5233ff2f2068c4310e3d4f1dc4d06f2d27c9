import { jsx as _jsx } from "react/jsx-runtime";
import * as React from 'react';
import { FloatingFocusManager, FloatingNode, FloatingOverlay, useDismiss, useFloating, useFloatingNodeId, useInteractions, useRole, } from '@floating-ui/react';
import { useForkRef } from "../../../hooks/index.js";
import { useFloatingTransition } from "../../../hooks/private/useFloatingTransition/index.js";
import { Portal } from "../../Portal/index.js";
import { block } from "../../utils/cn.js";
import { filterDOMProps } from "../../utils/filterDOMProps.js";
import { DRAWER_ANIMATION_DURATION_MS } from "../constants.js";
import i18n from "../i18n/index.js";
import { DrawerItem } from "./DrawerItem.js";
import "./Drawer.css";
const b = block('drawer');
export const Drawer = ({ open, onOpenChange, placement = 'left', children, contentClassName, resizable = false, size, minSize, maxSize, onResizeStart, onResizeEnd, onResize, className, style, qa, disableEscapeKeyDown, disableOutsideClick, initialFocus, returnFocus, disableBodyScrollLock = false, disableVisuallyHiddenDismiss, onTransitionIn, onTransitionInComplete, onTransitionOut, onTransitionOutComplete, floatingRef, disablePortal, keepMounted = false, container, ...restProps }) => {
    const floatingNodeId = useFloatingNodeId();
    const { refs, context } = useFloating({
        nodeId: floatingNodeId,
        open,
        onOpenChange,
    });
    const overlayRef = React.useRef(null);
    const { isMounted, status } = useFloatingTransition({
        context,
        duration: DRAWER_ANIMATION_DURATION_MS,
        onTransitionIn,
        onTransitionInComplete,
        onTransitionOut,
        onTransitionOutComplete,
    });
    const dismiss = useDismiss(context, {
        enabled: !disableEscapeKeyDown || !disableOutsideClick,
        outsidePress: (event) => {
            if (disableOutsideClick) {
                return false;
            }
            const isOwnOutsideClick = event.target.closest(`.${b()}`) === overlayRef.current;
            if (!isOwnOutsideClick) {
                return false;
            }
            return true;
        },
        escapeKey: !disableEscapeKeyDown,
    });
    const role = useRole(context, { role: 'dialog' });
    const { getFloatingProps } = useInteractions([dismiss, role]);
    /*
     *  TODO: Remove casting in React 19 (https://github.com/gravity-ui/uikit/issues/2537)
     */
    const handleFloatingRef = useForkRef(refs.setFloating, floatingRef);
    const portal = isMounted || keepMounted ? (_jsx(Portal, { container: container, disablePortal: disablePortal, children: _jsx(FloatingOverlay, { style: style, ref: overlayRef, className: b({
                open,
                placement,
            }, className), "data-qa": qa, "data-floating-ui-status": status, lockScroll: !disableBodyScrollLock, children: _jsx(FloatingFocusManager, { context: context, disabled: !isMounted, modal: isMounted, initialFocus: initialFocus ?? refs.floating, returnFocus: returnFocus, visuallyHiddenDismiss: disableVisuallyHiddenDismiss ? false : i18n('close'), restoreFocus: true, children: _jsx(DrawerItem, { ref: handleFloatingRef, open: open, placement: placement, className: contentClassName, resizable: resizable, size: size, onResize: onResize, onResizeStart: onResizeStart, onResizeEnd: onResizeEnd, minSize: minSize, maxSize: maxSize, overlayRef: overlayRef, ...filterDOMProps(restProps, { labelable: true }), ...getFloatingProps(), children: children }) }) }) })) : null;
    return _jsx(FloatingNode, { id: floatingNodeId, children: portal });
};
//# sourceMappingURL=Drawer.js.map
