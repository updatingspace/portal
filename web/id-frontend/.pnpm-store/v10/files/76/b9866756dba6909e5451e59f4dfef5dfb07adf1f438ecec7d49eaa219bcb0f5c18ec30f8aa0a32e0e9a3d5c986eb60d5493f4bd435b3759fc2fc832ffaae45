{"version":3,"file":"addComponentKeysets.js","sourceRoot":"../../../src","sources":["i18n/addComponentKeysets.ts"],"names":[],"mappings":"AAAA,OAAO,KAAK,KAAK,MAAM,OAAO,CAAC;AAI/B,OAAO,EAAC,OAAO,EAAC,uCAAoC;AAEpD,OAAO,EAAC,IAAI,EAAC,kBAAe;AAE5B;;;;;;;;;;;;;;;GAeG;AACH,MAAM,UAAU,mBAAmB,CAC/B,IAAuB,EACvB,aAAmB;IAEnB,MAAM,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC,OAAO,CAAC,CAAC,CAAC,IAAI,EAAE,IAAI,CAAC,EAAE,EAAE,CAAC,IAAI,CAAC,cAAc,CAAC,IAAI,EAAE,aAAa,EAAE,IAAI,CAAC,CAAC,CAAC;IAG/F,MAAM,iBAAiB,GAAG,IAAI,CAAC,MAAM,CAAO,aAAa,CAAC,CAAC;IAI3D,MAAM,cAAc,GAAqB,GAAG,EAAE;QAC1C,MAAM,UAAU,GAAG,OAAO,EAAE,CAAC;QAC7B,MAAM,EAAC,IAAI,GAAG,IAAI,EAAE,YAAY,GAAG,IAAI,EAAC,GAAG,IAAI,CAAC;QAChD,MAAM,CAAC,GAAG,KAAK,CAAC,WAAW,CACvB,CAAC,GAAG,MAAM,EAAE,EAAE;YACV,IAAI,CAAC,OAAO,CAAC,UAAU,CAAC,IAAI,CAAC,CAAC;YAC9B,IAAI,CAAC,eAAe,CAAC,UAAU,CAAC,YAAY,CAAC,CAAC;YAC9C,MAAM,MAAM,GAAG,iBAAiB,CAAC,GAAG,MAAM,CAAC,CAAC;YAC5C,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC;YACnB,IAAI,CAAC,eAAe,CAAC,YAAY,CAAC,CAAC;YACnC,OAAO,MAAM,CAAC;QAClB,CAAC,EACD,CAAC,YAAY,EAAE,IAAI,EAAE,UAAU,CAAC,YAAY,EAAE,UAAU,CAAC,IAAI,CAAC,CACjE,CAAC;QACF,OAAO,EAAC,CAAC,EAAC,CAAC;IACf,CAAC,CAAC;IACF,MAAM,CAAC,MAAM,CAAC,iBAAiB,EAAE;QAC7B,cAAc;QACd,WAAW,EAAE,CAAC,EAAC,QAAQ,EAAqD,EAAE,EAAE;YAC5E,OAAO,QAAQ,CAAC,cAAc,EAAE,CAAC,CAAC;QACtC,CAAC;KACJ,CAAC,CAAC;IAEH,OAAO,iBAON,CAAC;AACN,CAAC","sourcesContent":["import * as React from 'react';\n\nimport type {KeyData, KeysData} from '@gravity-ui/i18n';\n\nimport {useLang} from '../components/theme/useLang';\n\nimport {i18n} from './i18n';\n\n/**\n * Add component's keysets data\n * @param data - keysets data by languages\n * @param componentName - name of the component\n * @returns function to get keys' translations for current language\n * @example\n * ```\n * import {addComponentKeysets} from '@gravity-ui/uikit/i18n';\n * import en from './en.json';\n * import ru from './ru.json';\n *\n * const t = addComponentKeysets({en, ru}, 'Alert');\n *\n * console.log(t('label_close')); // 'Close'\n * ```\n */\nexport function addComponentKeysets<const T extends KeysData, const Name extends string>(\n    data: Record<string, T>,\n    componentName: Name,\n) {\n    Object.entries(data).forEach(([lang, keys]) => i18n.registerKeyset(lang, componentName, keys));\n\n    type TKey = Extract<keyof T, string>;\n    const translateFunction = i18n.keyset<TKey>(componentName);\n\n    type TType = typeof translateFunction;\n\n    const useTranslation: () => {t: TType} = () => {\n        const langConfig = useLang();\n        const {lang = 'en', fallbackLang = 'en'} = i18n;\n        const t = React.useCallback<TType>(\n            (...params) => {\n                i18n.setLang(langConfig.lang);\n                i18n.setFallbackLang(langConfig.fallbackLang);\n                const result = translateFunction(...params);\n                i18n.setLang(lang);\n                i18n.setFallbackLang(fallbackLang);\n                return result;\n            },\n            [fallbackLang, lang, langConfig.fallbackLang, langConfig.lang],\n        );\n        return {t};\n    };\n    Object.assign(translateFunction, {\n        useTranslation,\n        Translation: ({children}: {children: (props: {t: TType}) => React.ReactNode}) => {\n            return children(useTranslation());\n        },\n    });\n\n    return translateFunction as TType & {\n        Translation: React.ComponentType<{children: (props: {t: TType}) => React.ReactNode}>;\n        useTranslation: () => {t: TType};\n        /**\n         * Keyset data is used only for type inference, the value is always undefined.\n         */\n        keysetData: {[Key in Name]: Record<TKey, KeyData>};\n    };\n}\n"]}