"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.Drawer = void 0;
const tslib_1 = require("tslib");
const jsx_runtime_1 = require("react/jsx-runtime");
const React = tslib_1.__importStar(require("react"));
const react_1 = require("@floating-ui/react");
const hooks_1 = require("../../../hooks/index.js");
const useFloatingTransition_1 = require("../../../hooks/private/useFloatingTransition/index.js");
const Portal_1 = require("../../Portal/index.js");
const cn_1 = require("../../utils/cn.js");
const filterDOMProps_1 = require("../../utils/filterDOMProps.js");
const constants_1 = require("../constants.js");
const i18n_1 = tslib_1.__importDefault(require("../i18n/index.js"));
const DrawerItem_1 = require("./DrawerItem.js");
require("./Drawer.css");
const b = (0, cn_1.block)('drawer');
const Drawer = ({ open, onOpenChange, placement = 'left', children, contentClassName, resizable = false, size, minSize, maxSize, onResizeStart, onResizeEnd, onResize, className, style, qa, disableEscapeKeyDown, disableOutsideClick, initialFocus, returnFocus, disableBodyScrollLock = false, disableVisuallyHiddenDismiss, onTransitionIn, onTransitionInComplete, onTransitionOut, onTransitionOutComplete, floatingRef, disablePortal, keepMounted = false, container, ...restProps }) => {
    const floatingNodeId = (0, react_1.useFloatingNodeId)();
    const { refs, context } = (0, react_1.useFloating)({
        nodeId: floatingNodeId,
        open,
        onOpenChange,
    });
    const overlayRef = React.useRef(null);
    const { isMounted, status } = (0, useFloatingTransition_1.useFloatingTransition)({
        context,
        duration: constants_1.DRAWER_ANIMATION_DURATION_MS,
        onTransitionIn,
        onTransitionInComplete,
        onTransitionOut,
        onTransitionOutComplete,
    });
    const dismiss = (0, react_1.useDismiss)(context, {
        enabled: !disableEscapeKeyDown || !disableOutsideClick,
        outsidePress: (event) => {
            if (disableOutsideClick) {
                return false;
            }
            const isOwnOutsideClick = event.target.closest(`.${b()}`) === overlayRef.current;
            if (!isOwnOutsideClick) {
                return false;
            }
            return true;
        },
        escapeKey: !disableEscapeKeyDown,
    });
    const role = (0, react_1.useRole)(context, { role: 'dialog' });
    const { getFloatingProps } = (0, react_1.useInteractions)([dismiss, role]);
    /*
     *  TODO: Remove casting in React 19 (https://github.com/gravity-ui/uikit/issues/2537)
     */
    const handleFloatingRef = (0, hooks_1.useForkRef)(refs.setFloating, floatingRef);
    const portal = isMounted || keepMounted ? ((0, jsx_runtime_1.jsx)(Portal_1.Portal, { container: container, disablePortal: disablePortal, children: (0, jsx_runtime_1.jsx)(react_1.FloatingOverlay, { style: style, ref: overlayRef, className: b({
                open,
                placement,
            }, className), "data-qa": qa, "data-floating-ui-status": status, lockScroll: !disableBodyScrollLock, children: (0, jsx_runtime_1.jsx)(react_1.FloatingFocusManager, { context: context, disabled: !isMounted, modal: isMounted, initialFocus: initialFocus ?? refs.floating, returnFocus: returnFocus, visuallyHiddenDismiss: disableVisuallyHiddenDismiss ? false : (0, i18n_1.default)('close'), restoreFocus: true, children: (0, jsx_runtime_1.jsx)(DrawerItem_1.DrawerItem, { ref: handleFloatingRef, open: open, placement: placement, className: contentClassName, resizable: resizable, size: size, onResize: onResize, onResizeStart: onResizeStart, onResizeEnd: onResizeEnd, minSize: minSize, maxSize: maxSize, overlayRef: overlayRef, ...(0, filterDOMProps_1.filterDOMProps)(restProps, { labelable: true }), ...getFloatingProps(), children: children }) }) }) })) : null;
    return (0, jsx_runtime_1.jsx)(react_1.FloatingNode, { id: floatingNodeId, children: portal });
};
exports.Drawer = Drawer;
//# sourceMappingURL=Drawer.js.map
