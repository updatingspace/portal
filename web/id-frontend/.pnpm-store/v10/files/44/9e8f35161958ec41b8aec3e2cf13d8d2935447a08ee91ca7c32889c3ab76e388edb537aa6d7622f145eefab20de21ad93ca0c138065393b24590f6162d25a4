{"version":3,"file":"AccordionContext.js","sourceRoot":"../../../../src","sources":["components/Accordion/AccordionContext.tsx"],"names":[],"mappings":"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","sourcesContent":["import * as React from 'react';\n\nimport {useControlledState} from '../../../src/hooks';\n\nimport type {AccordionProps, AccordionValue} from './types';\n\ninterface AccordionProviderProps<Multiple extends boolean>\n    extends Required<\n        Omit<\n            AccordionProps<Multiple>,\n            'qa' | 'className' | 'value' | 'defaultValue' | 'multiple' | 'ariaLabel'\n        >\n    > {\n    multiple: Multiple;\n    value: AccordionValue<Multiple>;\n    defaultValue: AccordionValue<Multiple>;\n    onUpdate: (value: AccordionValue<Multiple>) => void;\n}\n\ninterface AccordionSummaryRef {\n    element: HTMLButtonElement;\n    disabled: boolean;\n}\n\nconst AccordionContext = React.createContext<\n    Required<\n        Omit<\n            AccordionProps<boolean>,\n            'defaultValue' | 'className' | 'children' | 'onUpdate' | 'qa' | 'value' | 'ariaLabel'\n        > & {\n            items: AccordionValue<boolean>;\n            updateItems: (value: AccordionItemValue) => void;\n            registerSummary: (id: string, ref: AccordionSummaryRef) => void;\n            unregisterSummary: (id: string) => void;\n            getSummaryRefs: () => AccordionSummaryRef[];\n        }\n    >\n>({\n    size: 'm',\n    view: 'solid',\n    multiple: false,\n    arrowPosition: 'start',\n    ariaLevel: 3,\n    items: null,\n    updateItems: () => {},\n    registerSummary: () => {},\n    unregisterSummary: () => {},\n    getSummaryRefs: () => [],\n});\n\ntype AccordionItemValue = string;\n\nexport function AccordionProvider<Multiple extends boolean>(\n    props: AccordionProviderProps<Multiple>,\n) {\n    const {\n        ariaLevel,\n        children,\n        arrowPosition,\n        size,\n        view,\n        multiple,\n        defaultValue,\n        onUpdate,\n        value,\n    } = props;\n\n    const getDefaultValue = () => {\n        if (defaultValue !== undefined) return defaultValue;\n        return multiple ? ([] as string[]) : null;\n    };\n\n    const [items, setItems] = useControlledState<AccordionValue<Multiple>>(\n        value as Exclude<AccordionValue<Multiple>, undefined> | undefined,\n        getDefaultValue() as Exclude<AccordionValue<Multiple>, undefined>,\n        onUpdate,\n    );\n\n    const summaryRefsRef = React.useRef<Map<string, AccordionSummaryRef>>(new Map());\n\n    React.useEffect(() => {\n        if (!Array.isArray(items) && multiple) {\n            setItems((items ? [items] : []) as AccordionValue<Multiple>);\n            return;\n        }\n        // This useEffect is used only for handling the case of switching the 'multiple' value from false to true\n        // eslint-disable-next-line react-hooks/exhaustive-deps\n    }, [multiple]);\n\n    const updateItems = (itemValue: string) => {\n        if (multiple) {\n            // can cast to string[] because of multiple\n            const castedPrev = (items || []) as string[];\n            let newValue: string[] = [];\n            if (castedPrev.includes(itemValue)) {\n                // clicked on expanded -> close\n                newValue = castedPrev.filter((item: string) => item !== itemValue);\n            } else {\n                // clicked on non-expanded -> open\n                newValue = [...castedPrev, itemValue];\n            }\n            const res = newValue as AccordionValue<Multiple>;\n            setItems(res);\n            return;\n        }\n        let newValue = itemValue as AccordionValue<Multiple>;\n        // clicked on expanded -> close\n        if (itemValue === items) {\n            newValue = null as AccordionValue<Multiple>;\n        }\n        setItems(newValue);\n    };\n\n    const registerSummary = React.useCallback((id: string, ref: AccordionSummaryRef) => {\n        summaryRefsRef.current.set(id, ref);\n    }, []);\n\n    const unregisterSummary = React.useCallback((id: string) => {\n        summaryRefsRef.current.delete(id);\n    }, []);\n\n    const getSummaryRefs = React.useCallback((): AccordionSummaryRef[] => {\n        return Array.from(summaryRefsRef.current.values()).filter((ref) => !ref.disabled);\n    }, []);\n\n    return (\n        <AccordionContext.Provider\n            value={{\n                ariaLevel,\n                arrowPosition,\n                size,\n                view,\n                multiple,\n                items,\n                updateItems,\n                registerSummary,\n                unregisterSummary,\n                getSummaryRefs,\n            }}\n        >\n            {children}\n        </AccordionContext.Provider>\n    );\n}\n\nexport function useAccordion() {\n    const state = React.useContext(AccordionContext);\n\n    return state;\n}\n"]}