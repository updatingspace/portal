{"version":3,"file":"SelectControl.js","sourceRoot":"../../../../../../src","sources":["components/Select/components/SelectControl/SelectControl.tsx"],"names":[],"mappings":"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","sourcesContent":["'use client';\n\nimport * as React from 'react';\n\nimport {ChevronDown, TriangleExclamation} from '@gravity-ui/icons';\n\nimport {useUniqId} from '../../../../hooks';\nimport {Icon} from '../../../Icon';\nimport {Popover} from '../../../legacy';\nimport type {AriaLabelingProps} from '../../../types';\nimport type {CnMods} from '../../../utils/cn';\nimport {filterDOMProps} from '../../../utils/filterDOMProps';\nimport {selectControlBlock, selectControlButtonBlock} from '../../constants';\nimport i18n from '../../i18n';\nimport type {\n    SelectProps,\n    SelectRenderClearArgs,\n    SelectRenderControl,\n    SelectRenderCounter,\n    SelectRenderTriggerProps,\n} from '../../types';\nimport {SelectClear} from '../SelectClear/SelectClear';\nimport {SelectCounter} from '../SelectCounter/SelectCounter';\n\nimport './SelectControl.scss';\n\ntype ControlProps = {\n    toggleOpen: () => void;\n    renderControl?: SelectRenderControl;\n    renderCounter?: SelectRenderCounter;\n    view: NonNullable<SelectProps['view']>;\n    size: NonNullable<SelectProps['size']>;\n    pin: NonNullable<SelectProps['pin']>;\n    selectedOptionsContent: React.ReactNode;\n    className?: string;\n    qa?: string;\n    label?: string;\n    placeholder?: SelectProps['placeholder'];\n    isErrorVisible?: boolean;\n    errorMessage?: SelectProps['errorMessage'];\n    disabled?: boolean;\n    value: NonNullable<SelectProps['value']>;\n    clearValue: () => void;\n    hasClear?: boolean;\n    hasCounter?: boolean;\n    title?: string;\n    onKeyDown?: (e: React.KeyboardEvent<HTMLElement>) => void;\n    open: boolean;\n    popupId: string;\n    selectId: string;\n    activeIndex?: number;\n} & AriaLabelingProps;\n\nexport const SelectControl = React.forwardRef<HTMLButtonElement, ControlProps>((props, ref) => {\n    const {\n        toggleOpen,\n        clearValue,\n        onKeyDown,\n        renderControl,\n        view,\n        size,\n        pin,\n        selectedOptionsContent,\n        className,\n        qa,\n        label,\n        placeholder,\n        isErrorVisible,\n        errorMessage,\n        open,\n        disabled,\n        value,\n        hasClear,\n        popupId,\n        selectId,\n        activeIndex,\n        renderCounter,\n        hasCounter,\n        title,\n    } = props;\n    const showOptionsText = Boolean(selectedOptionsContent);\n    const showPlaceholder = Boolean(placeholder && !showOptionsText);\n    const hasValue = Array.isArray(value) && value.filter(Boolean).length > 0;\n    const errorTooltipId = useUniqId();\n\n    const [isDisabledButtonAnimation, setIsDisabledButtonAnimation] = React.useState(false);\n\n    const controlMods: CnMods = {\n        open,\n        size,\n        pin,\n        disabled,\n        error: isErrorVisible,\n        'has-clear': hasClear,\n        'no-active': isDisabledButtonAnimation,\n        'has-value': hasValue,\n    };\n\n    const buttonMods: CnMods = {\n        open,\n        size,\n        view,\n        pin,\n        disabled,\n        error: isErrorVisible,\n    };\n\n    const handleControlClick = React.useCallback(\n        (e?: React.MouseEvent<HTMLElement>) => {\n            // Fix for Safari\n            // https://developer.mozilla.org/en-US/docs/Web/HTML/Element/button#clicking_and_focus\n            if (e && e.currentTarget !== document.activeElement && 'focus' in e.currentTarget) {\n                e.currentTarget.focus();\n            }\n\n            toggleOpen();\n        },\n        [toggleOpen],\n    );\n\n    const disableButtonAnimation = React.useCallback(() => {\n        setIsDisabledButtonAnimation(true);\n    }, []);\n    const enableButtonAnimation = React.useCallback(() => {\n        setIsDisabledButtonAnimation(false);\n    }, []);\n    const handleOnClearIconClick = React.useCallback(() => {\n        // return animation on clear click\n        setIsDisabledButtonAnimation(false);\n        clearValue();\n    }, [clearValue]);\n\n    const renderCounterComponent = () => {\n        if (!hasCounter) {\n            return null;\n        }\n        const count = value.length;\n        const counterComponent = <SelectCounter count={count} size={size} disabled={disabled} />;\n        return renderCounter\n            ? renderCounter(counterComponent, {count, size, disabled})\n            : counterComponent;\n    };\n\n    const renderClearIcon = (args: SelectRenderClearArgs) => {\n        const valueIsEmpty = value.length === 0;\n        if (!hasClear || valueIsEmpty || disabled) {\n            return null;\n        }\n        return (\n            <SelectClear\n                size={size}\n                onClick={handleOnClearIconClick}\n                onMouseEnter={disableButtonAnimation}\n                onMouseLeave={enableButtonAnimation}\n                renderIcon={args.renderIcon}\n            />\n        );\n    };\n\n    const triggerProps: SelectRenderTriggerProps = {\n        ...filterDOMProps(props, {labelable: true}),\n        id: selectId,\n        role: 'combobox',\n        'aria-controls': open ? popupId : undefined,\n        'aria-haspopup': 'listbox',\n        'aria-expanded': open,\n        'aria-activedescendant':\n            activeIndex === undefined ? undefined : `${popupId}-item-${activeIndex}`,\n        onClick: handleControlClick,\n        onKeyDown,\n        disabled,\n    };\n\n    const {t} = i18n.useTranslation();\n\n    if (renderControl) {\n        return renderControl(\n            {\n                onClear: clearValue,\n                renderClear: renderClearIcon,\n                renderCounter: renderCounterComponent,\n                ref,\n                open,\n                disabled,\n                triggerProps,\n            },\n            {value},\n        );\n    }\n\n    return (\n        <React.Fragment>\n            <div className={selectControlBlock(controlMods)} role=\"group\">\n                <button\n                    ref={ref}\n                    className={selectControlButtonBlock(buttonMods, className)}\n                    type=\"button\"\n                    data-qa={qa}\n                    title={title}\n                    tabIndex={0}\n                    {...triggerProps}\n                >\n                    {label && <span className={selectControlBlock('label')}>{label}</span>}\n                    {showPlaceholder && (\n                        <span className={selectControlBlock('placeholder')}>{placeholder}</span>\n                    )}\n                    {showOptionsText && (\n                        <span className={selectControlBlock('option-text')}>\n                            {selectedOptionsContent}\n                        </span>\n                    )}\n                </button>\n                {renderCounterComponent()}\n                {renderClearIcon({})}\n\n                {errorMessage && (\n                    <Popover content={errorMessage} tooltipId={errorTooltipId}>\n                        <button\n                            aria-label={t('label_show-error-info')}\n                            aria-describedby={errorTooltipId}\n                            type={'button'}\n                            className={selectControlBlock('error-icon')}\n                        >\n                            <Icon data={TriangleExclamation} size={size === 's' ? 12 : 16} />\n                        </button>\n                    </Popover>\n                )}\n\n                <Icon\n                    className={selectControlBlock('chevron-icon', {disabled})}\n                    data={ChevronDown}\n                    aria-hidden=\"true\"\n                />\n            </div>\n        </React.Fragment>\n    );\n});\n\nSelectControl.displayName = 'SelectControl';\n"]}