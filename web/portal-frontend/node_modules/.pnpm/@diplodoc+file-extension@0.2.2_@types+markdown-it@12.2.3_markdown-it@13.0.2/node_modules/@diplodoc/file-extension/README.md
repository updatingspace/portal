[![NPM version](https://img.shields.io/npm/v/@diplodoc/file-extension.svg?style=flat)](https://www.npmjs.org/package/@diplodoc/file-extension)

# @diplodoc/file-extension

Diplodoc platform extension that provides file links in documentation. Allows adding downloadable file links with customizable styling and asset bundling support.

## Features

- **MarkdownIt transform plugin** — Process file directives in YFM
- **Runtime styles** — SCSS styles for file links
- **File markup syntax** — `{% file src="..." name="..." %}` syntax support
- **Directive syntax** — Modern `:file[name](url)` syntax support
- **Asset bundling** — Integration with documentation build process

## Installation

```bash
npm install @diplodoc/file-extension
```

## Usage

### Quickstart

Attach the plugin to the transformer:

```js
import * as fileExtension from '@diplodoc/file-extension';
import transform from '@diplodoc/transform';

const {result} = await transform(
  `
Download here: {% file src="path/to/file" name='readme.md' %}
`,
  {
    plugins: [fileExtension.transform({bundle: false})],
  },
);
```

## Prepared styles

It is necessary to add styles for file links on your page.<br/>
You can add assets files which were generated by the [MarkdownIt transform plugin](#markdownit-transform-plugin).

```html
<html>
  <head>
    <!-- Read more about '_assets/file-extension.css' in 'Transform plugin' section -->
    <link rel="stylesheet" href="_assets/file-extension.css" />
  </head>
  <body>
    ${result.html}
  </body>
</html>
```

Or you can just include styles source code in your bundle.

```js
import '@diplodoc/cut-extension/runtime/styles.css';
```

## MarkdownIt transform plugin

Plugin for [@diplodoc/transform](https://github.com/diplodoc-platform/transform) package.

Options:

- `runtime.style` - name on runtime css file which will be exposed in results `style` section.<br>
  (Default: `_assets/file-extension.css`)<br>

- `bundle` - boolean flag to enable/disable copying of bundled runtime to target directory.<br>
  Where target directore is `<transformer output option>/<plugin runtime option>`<br>
  Default: `true`<br>

- `extraAttrs` – array of additional attributes in format `[name, value]`, that will be added to file links\
  Default: `undefined`

- `directiveSyntax` – enables new [directive syntax](#directive-syntax). \
  Available values: `'disabled' | 'enabled' | 'only'`\
  Default: `'disabled'`

## File markup

```md
{% file src="path/to/file" name='readme.md' %}

==>

<a href="path/to/file" download="readme.md" class="yfm-file"><span class="yfm-file__icon"></span>readme.md</a>
```

### Supported attributes:

| Name             | Required | Description                                                                                                                                  |
| ---------------- | -------- | -------------------------------------------------------------------------------------------------------------------------------------------- |
| `src`            | yes      | URL of the file. Will be mapped to [`href` attribute](https://developer.mozilla.org/en-US/docs/Web/HTML/Element/a#href)                      |
| `name`           | yes      | Name of the file. Will be mapped to [`download` attribute](https://developer.mozilla.org/en-US/docs/Web/HTML/Element/a#download)             |
| `lang`           | -        | Language of the file content. Will be mapped to [`hreflang` attribute](https://developer.mozilla.org/en-US/docs/Web/HTML/Element/a#hreflang) |
| `referrerpolicy` | -        | [`referrerpolicy` attribute](https://developer.mozilla.org/en-US/docs/Web/HTML/Element/a#referrerpolicy)                                     |
| `rel`            | -        | [`rel` attribute](https://developer.mozilla.org/en-US/docs/Web/HTML/Element/a#rel)                                                           |
| `target`         | -        | [`target` attribute](https://developer.mozilla.org/en-US/docs/Web/HTML/Element/a#target)                                                     |
| `type`           | -        | [`type` attribute](https://developer.mozilla.org/en-US/docs/Web/HTML/Element/a#type)                                                         |

> _Note: other attributes will be ignored_

## Directive syntax

Also you can use inline directive syntax for file links. For more information see here: [diplodoc-platform/directive](https://github.com/diplodoc-platform/directive/?tab=readme-ov-file#directive-syntax).

To enable directive syntax pass `directiveSyntax: 'enabled'` to options. Or you can disabled old syntax and use only directive syntax: `directiveSyntax: 'only'`.

```md
:file[<file-name>](file-url)

<!-- Example: -->

:file[readme.md](path/to/readme/md){type=text/plain}
```

### Supported attributes:

| Name             | Description                                                                                                     |
| ---------------- | --------------------------------------------------------------------------------------------------------------- |
| `hreflang`       | [anchor `hreflang` attribute](https://developer.mozilla.org/en-US/docs/Web/HTML/Element/a#hreflang)             |
| `referrerpolicy` | [anchor `referrerpolicy` attribute](https://developer.mozilla.org/en-US/docs/Web/HTML/Element/a#referrerpolicy) |
| `rel`            | [anchor `rel` attribute](https://developer.mozilla.org/en-US/docs/Web/HTML/Element/a#rel)                       |
| `target`         | [anchor `target` attribute](https://developer.mozilla.org/en-US/docs/Web/HTML/Element/a#target)                 |
| `type`           | [anchor `type` attribute](https://developer.mozilla.org/en-US/docs/Web/HTML/Element/a#type)                     |

> _Note: other attributes will be ignored_

## CSS public variables

- `--yfm-file-icon` – sets custom file icon image
- `--yfm-file-icon-color` – sets custom file icon color

## Development

### Setup

```bash
# Install dependencies
npm install

# Build package
npm run build

# Run tests
npm test

# Lint code
npm run lint
```

## Documentation

For detailed information about architecture, development, and contributing, see [AGENTS.md](./AGENTS.md).

## License

MIT
