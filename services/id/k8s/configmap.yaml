apiVersion: v1
kind: Namespace
metadata:
  name: updspace-id
  labels:
    app.kubernetes.io/name: updspace-id
    app.kubernetes.io/part-of: updspace
---
# ConfigMap for non-sensitive configuration
apiVersion: v1
kind: ConfigMap
metadata:
  name: id-service-config
  namespace: updspace-id
  labels:
    app: id-service
data:
  DJANGO_DEBUG: "false"
  DJANGO_ALLOWED_HOSTS: "id.updspace.com,id-service.updspace-id.svc.cluster.local"
  LOG_LEVEL: "INFO"
  LOG_FORMAT: "json"
  
  # CORS & CSRF
  CORS_ALLOWED_ORIGINS: "https://id.updspace.com,https://portal.updspace.com"
  CSRF_TRUSTED_ORIGINS: "https://id.updspace.com,https://portal.updspace.com"
  
  # Session & Cookie security
  SESSION_COOKIE_SECURE: "true"
  SESSION_COOKIE_SAMESITE: "Strict"
  CSRF_COOKIE_SECURE: "true"
  CSRF_COOKIE_SAMESITE: "Strict"
  SECURE_SSL_REDIRECT: "true"
  
  # OIDC configuration
  OIDC_ISSUER: "https://id.updspace.com"
  OIDC_PUBLIC_BASE_URL: "https://id.updspace.com"
  
  # Email configuration
  EMAIL_HOST: "smtp.sendgrid.net"
  EMAIL_PORT: "587"
  EMAIL_USE_TLS: "true"
  DEFAULT_FROM_EMAIL: "no-reply@updspace.com"
  
  # Rate limiting
  RATE_LIMIT_OIDC_TOKEN: "60"
  RATE_LIMIT_OIDC_USERINFO: "120"
  RATE_LIMIT_OIDC_AUTHORIZE: "30"
---
# Secret placeholder (values should be provided via external secrets management)
apiVersion: v1
kind: Secret
metadata:
  name: id-service-secrets
  namespace: updspace-id
  labels:
    app: id-service
type: Opaque
stringData:
  # IMPORTANT: Replace these with actual secrets in production!
  # Consider using external secrets manager (Vault, AWS Secrets Manager, etc.)
  DJANGO_SECRET_KEY: "REPLACE_WITH_SECURE_SECRET_KEY"
  DATABASE_URL: "postgres://user:password@postgres:5432/id_service"
  REDIS_URL: "redis://redis:6379/0"
  
  # OIDC Keys (base64 encoded PEM)
  OIDC_PRIVATE_KEY_PEM: ""
  OIDC_PUBLIC_KEY_PEM: ""
  
  # Email credentials
  EMAIL_HOST_USER: ""
  EMAIL_HOST_PASSWORD: ""
  
  # OAuth providers
  GITHUB_CLIENT_ID: ""
  GITHUB_CLIENT_SECRET: ""
  DISCORD_CLIENT_ID: ""
  DISCORD_CLIENT_SECRET: ""
  STEAM_API_KEY: ""
  
  # BFF HMAC secret
  BFF_INTERNAL_HMAC_SECRET: ""
